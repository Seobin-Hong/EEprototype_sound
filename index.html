<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIDI ë°˜ì‘ ì´ë¯¸ì§€ + ë‹¤ì–‘í•œ ì‚¬ìš´ë“œ</title>
    <style>
        body {
            position: relative;
            background-color: black;
            overflow: hidden;
            height: 100vh;
            margin: 0;
        }
        .image {
            position: absolute;
            transition: opacity 1s ease-out, transform 1s ease-out, filter 1s ease-out;
            transform-origin: center;
            filter: blur(10px);
        }
    </style>
</head>
<body>
    <script>
        // ğŸµ Web Audio API ì„¤ì • (ë‹¤ì–‘í•œ ì‚¬ìš´ë“œ)
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSynth(note, velocity) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();

            const frequency = 440 * Math.pow(2, (note - 69) / 12);
            osc.frequency.value = frequency;

            // âœ… ë‹¤ì–‘í•œ ì „ììŒ ì„¤ì • (ëœë¤ìœ¼ë¡œ ë°”ê¾¸ê¸°)
            const waveTypes = ["sine", "square", "sawtooth", "triangle"];
            osc.type = waveTypes[Math.floor(Math.random() * waveTypes.length)]; // ëœë¤ íŒŒí˜• ì ìš©

            gain.gain.value = velocity / 127; // ê±´ë°˜ ì„¸ê¸°ì— ë”°ë¼ ë³¼ë¥¨ ì¡°ì ˆ

            // âœ… í•„í„° ì¶”ê°€ (ë¶€ë“œëŸ½ê±°ë‚˜ ë‚ ì¹´ë¡œìš´ ì†Œë¦¬)
            filter.type = "lowpass"; // ì €ìŒë§Œ í†µê³¼
            filter.frequency.value = 800 + (velocity * 5); // Velocityì— ë”°ë¼ í•„í„° ë³€í™”

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(audioContext.destination);

            osc.start();
            osc.stop(audioContext.currentTime + 0.3);
        }

        // ğŸ§ ìƒ˜í”Œë§ëœ ìŒì› (MIDI ë…¸íŠ¸ë³„ë¡œ ë‹¤ë¥¸ ì‚¬ìš´ë“œ)
        const soundMap = {
            60: "sounds/kick.wav",
            62: "sounds/snare.wav",
            64: "sounds/hihat.wav",
            65: "sounds/clap.wav",
        };

        function playSampledSound(note) {
            if (!soundMap[note]) return;
            const sound = new Audio(soundMap[note]);
            sound.play();
        }

        // ğŸ¨ ì´ë¯¸ì§€ ê´€ë ¨ ì½”ë“œ
        const images = ["1.png", "6.png", "7.png", "8.png", "9.png"];

        function getRandomImage() {
            return images[Math.floor(Math.random() * images.length)];
        }

        function getRandomX() {
            return Math.random() * window.innerWidth;
        }

        function getRandomY() {
            const centerY = window.innerHeight / 2;
            const range = window.innerHeight * 0.2;
            return centerY + (Math.random() * range * 2 - range);
        }

        function getImageSize(velocity) {
            return 50 + (velocity / 127) * 50;
        }

        function createImage(velocity) {
            const img = document.createElement("img");
            img.src = getRandomImage();
            img.classList.add("image");

            img.style.left = `${getRandomX()}px`;
            img.style.top = `${getRandomY()}px`;
            img.style.opacity = 0;
            const size = getImageSize(velocity);
            img.style.width = `${size}px`;
            img.style.transform = `scale(0.5)`;
            img.style.filter = "blur(10px)";

            const rotationDirection = Math.random() < 0.5 ? 360 : -360;

            const rotateAnimation = `rotateEffect${rotationDirection}`;
            const styleSheet = document.styleSheets[0];
            styleSheet.insertRule(`
                @keyframes ${rotateAnimation} {
                    0% { transform: scale(1) rotate(0deg); }
                    100% { transform: scale(1) rotate(${rotationDirection}deg); }
                }
            `, styleSheet.cssRules.length);

            img.style.animation = `${rotateAnimation} 30s linear infinite`;

            document.body.appendChild(img);

            setTimeout(() => {
                img.style.opacity = 1;
                img.style.transform = `scale(1)`;
                img.style.filter = "blur(0px)";
            }, 10);

            setTimeout(() => {
                img.style.opacity = 0;
                img.style.transform = `scale(1.2) rotate(${rotationDirection * 2}deg)`;
                img.style.filter = "blur(10px)";
                setTimeout(() => img.remove(), 1000);
            }, 5000);
        }

        // ğŸ› MIDI ì…ë ¥ ê°ì§€ + ë‹¤ì–‘í•œ ì‚¬ìš´ë“œ ì¶”ê°€
        function onMIDIMessage(event) {
            const [command, note, velocity] = event.data;
            if (command === 144 && velocity > 0) {
                createImage(velocity);
                playSynth(note, velocity); // ì „ììŒ ì¶”ê°€
                playSampledSound(note); // ìƒ˜í”Œë§ ì‚¬ìš´ë“œ ì¶”ê°€
            }
        }

        function initMIDI() {
            navigator.requestMIDIAccess().then(midiAccess => {
                midiAccess.inputs.forEach(input => {
                    input.onmidimessage = onMIDIMessage;
                });
            }).catch(err => console.error("MIDI ì ‘ê·¼ ì˜¤ë¥˜:", err));
        }

        window.onload = initMIDI;
    </script>
</body>
</html>
